jQuery(document).ready(function(e){function t(){return window.FreemKitAdmin||{}}function n(e,n){var o,r;e.find(".freemkit-webhook-copy-status").text((o=n?"copy_success":"copy_failed",r=n?"Webhook URL copied.":"Copy failed. Select and copy manually.",(t().strings||{})[o]||r)).css("color",n?"#2271b1":"#a60000")}function o(e){e.length&&e[0]&&(e.trigger("focus").trigger("select"),"function"==typeof e[0].setSelectionRange&&e[0].setSelectionRange(0,String(e.val()||"").length))}function r(){var n=e('select[name="freemkit_settings[webhook_endpoint_type]"]'),o=e(".webhook-url-container");if(n.length&&o.length){var r=function(e,n){var o=t().webhook_urls||{},r=o.rest||n.data("rest-url")||"",c=o.query||n.data("query-url")||"";return"query"===e?c:r}(n.val(),o);o.find(".freemkit-webhook-url-input").val(r),o.find(".freemkit-webhook-url-code").text(r)}}function c(e,t){if(!e)return!1;t.length&&o(t);var n=!1,r=function(t){t.preventDefault(),t.clipboardData&&t.clipboardData.setData("text/plain",e)};document.addEventListener("copy",r);try{n=!!document.execCommand("copy")}catch(e){n=!1}return document.removeEventListener("copy",r),n}function i(e){var t=e.find(".freemkit-webhook-url-input"),r=String(t.val()||e.find(".freemkit-webhook-url-code").text()||"").trim();if(r){t.length&&o(t);var i=function(r){t.length&&o(t),n(e,r)};window.isSecureContext&&navigator.clipboard&&"function"==typeof navigator.clipboard.writeText?navigator.clipboard.writeText(r).then(function(){i(!0)}).catch(function(){i(c(r,t))}):i(c(r,t))}}e(document).on("change",'select[name="freemkit_settings[webhook_endpoint_type]"]',function(){r()}),e(document).on("click",".freemkit-webhook-copy",function(t){t.preventDefault(),i(e(this).closest(".webhook-url-container"))}),e(document).on("click",".freemkit-webhook-url-code",function(t){t.preventDefault(),i(e(this).closest(".webhook-url-container"))}),e(document).on("click focus",".freemkit-webhook-url-input",function(){var t=e(this);o(t),i(t.closest(".webhook-url-container"))}),r(),e(".freemkit_cache_clear").on("click",function(n){n.preventDefault();var o=e(this),r=o.text(),c=t();o.prop("disabled",!0).text("Clearing...");var i={action:"freemkit_refresh_lists",nonce:c.nonce||""};e.post(c.ajax_url||ajaxurl,i,function(e){if(e.success)alert(c.strings&&c.strings.cache_cleared||"Cache cleared successfully!");else{var t=e&&e.data&&e.data.message?e.data.message:"Unknown error";alert((c.strings&&c.strings.cache_error||"Error clearing cache: ")+" "+t)}}).always(function(){o.prop("disabled",!1).text(r)})})});