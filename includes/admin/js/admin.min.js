jQuery(document).ready(function(e){function n(){return window.GlueLinkAdmin||{}}function t(e,t){var o,c;e.find(".glue-link-webhook-copy-status").text((o=t?"copy_success":"copy_failed",c=t?"Webhook URL copied.":"Copy failed. Select and copy manually.",(n().strings||{})[o]||c)).css("color",t?"#2271b1":"#a60000")}function o(e){e.length&&e[0]&&(e.trigger("focus").trigger("select"),"function"==typeof e[0].setSelectionRange&&e[0].setSelectionRange(0,String(e.val()||"").length))}function c(){var t=e('select[name="glue_link_settings[webhook_endpoint_type]"]'),o=e(".webhook-url-container");if(t.length&&o.length){var c=function(e,t){var o=n().webhook_urls||{},c=o.rest||t.data("rest-url")||"",i=o.query||t.data("query-url")||"";return"query"===e?i:c}(t.val(),o);o.find(".glue-link-webhook-url-input").val(c),o.find(".glue-link-webhook-url-code").text(c)}}function i(e,n){if(!e)return!1;n.length&&o(n);var t=!1,c=function(n){n.preventDefault(),n.clipboardData&&n.clipboardData.setData("text/plain",e)};document.addEventListener("copy",c);try{t=!!document.execCommand("copy")}catch(e){t=!1}return document.removeEventListener("copy",c),t}function r(e){var n=e.find(".glue-link-webhook-url-input"),c=String(n.val()||e.find(".glue-link-webhook-url-code").text()||"").trim();if(c){n.length&&o(n);var r=function(c){n.length&&o(n),t(e,c)};window.isSecureContext&&navigator.clipboard&&"function"==typeof navigator.clipboard.writeText?navigator.clipboard.writeText(c).then(function(){r(!0)}).catch(function(){r(i(c,n))}):r(i(c,n))}}e(document).on("change",'select[name="glue_link_settings[webhook_endpoint_type]"]',function(){c()}),e(document).on("click",".glue-link-webhook-copy",function(n){n.preventDefault(),r(e(this).closest(".webhook-url-container"))}),e(document).on("click",".glue-link-webhook-url-code",function(n){n.preventDefault(),r(e(this).closest(".webhook-url-container"))}),e(document).on("click focus",".glue-link-webhook-url-input",function(){var n=e(this);o(n),r(n.closest(".webhook-url-container"))}),c(),e(".glue_link_cache_clear").on("click",function(t){t.preventDefault();var o=e(this),c=o.text(),i=n();o.prop("disabled",!0).text("Clearing...");var r={action:"glue_link_refresh_lists",nonce:i.nonce||""};e.post(i.ajax_url||ajaxurl,r,function(e){if(e.success)alert(i.strings&&i.strings.cache_cleared||"Cache cleared successfully!");else{var n=e&&e.data&&e.data.message?e.data.message:"Unknown error";alert((i.strings&&i.strings.cache_error||"Error clearing cache: ")+" "+n)}}).always(function(){o.prop("disabled",!1).text(c)})})});